# 비동기와 동기 그리고 멀티스레드.... 헷갈린다 이 자슥들아...
몇 년만에 처음 본 면접에서 받아본 질문이다. 신입 수준의 질문에서는 매우 흔한 질문이지만 나는 이 흔하디 흔한 질문에 명확한 답변을 하지 못했다. 면접관의 표정을 보니 아직도 가슴이 아려온다... 부끄러운 순간을 다시 마주하지 않기 위해 다시 한번 정리하자

> 동기와 비동기의 차이에 대해서 설명해주세요?

이렇게 질문을 받으면 뭐라고 답변을 해야 할까? 우선 동기는 일반적인 프로세스 실행 흐름을 생각하면 된다. 일반적인 동기식 프로세스 순차적으로 실행된다. 즉, 정해진 레시피에 따라 프로세스가 실행된다. 별도의 비동기 로직을 사용하지 않고 일반적으로 실행되는 프로세스 흐름을 동기적이라고 한다. 조금 더 정리한 버전은 다음과 같다.

> 동기는 요청과 응답이 순차적으로 진행되어, 하나의 작업이 끝나야 다음 작업이 이어지는 흐름이다. 즉 핵심은 '순차적 실행'이다.

그렇다면 비동기는 뭘까? 예전에는 여러 스레드를 사용하는 게 비동기 방식이라고 생각했다. 하지만 이는 잘못된 이해다. 하나의 스레드로도 비동기 방식은 얼마든지 구현 가능하다. (오히려 두 개 이상의 스레드는 비동기가 아닌 멀티 스레드 방식이라고 하는 게 옳다) 

프로세스가 실행되려면 하나 이상의 스레드(실행 흐름의 단위) 단위로 실행된다. 그리고 스레드가 로직을 순차적으로 실행하기 위해서는 운영체제로부터 CPU 자원을 할당 받아야 한다. 그런데 프로세스 로직 중에는 CPU 자원을 사용할 필요가 없는 작업도 있다. 파일을 열고 닫거나 DB에서 데이터를 CRUD할 때가 대표적인 예다. 이러한 작업들은 CPU 자원을 직접적으로 사용하지는 않음에도 동기적으로 실행될 때는 CPU 자원이 사용되지 않은 채 해당 작업들이 끝날 때까지 하염없이 기다려야 비효율이 발생한다. CPU 자원이 낭비되는 순간이다. 여기서 비동기 방식이 필요하다. 

비동기 방식은 스레드가 CPU 자원을 사용할 필요가 없는 작업을 실행할 때 해당 작업을 마칠 때까지 기다리지 않고 다른 작업을 수행하는 것이다. 즉, 위에서 예로 들었던 별도의 IO 작업은 IO 작업대로 실행되게 놔두고 원래 스레드는 다른 작업을 계속 수행하되, 해당 IO 작업이 끝나면 콜백(callback) 방식으로 작업이 끝났다는 걸 이벤트 등으로 스레드에게 알려주고 다시금 해당 작업을 이어나가는 것이다. 요리로 비유하자면 요리사는 떡볶이를 할 때 계란이 삶을 때까지 앞에서 대기하는 게 아니라, 계란이 삶아질 동안 옆에서 야채 등을 손질하는 것이비동기 방식의 본질이다. 
## 그렇다면 비동기와 멀티스레드의 차이점은 뭐라고 해야 하지?
동기와 비동기는 나만의 언어로 표현할 수 있을 만큼 어느 정도 이해가 됐다. 그런데 비동기와 멀티스레드가 또 헷갈리기 시작했다. 스레드는 프로세스의 실행 흐름의 단위다. 즉 하나의 스레드가 있으면 프로세스는 순차적으로 실행될 것이다. 반면 프로세스에서 두 개의 스레드 흐름이 있다면 로직들이 두 개의 흐름으로 분기될 것이다. 구글 문서로 예를 들면, 여러 사용자가 동시에 문서를 편집할 때, 각 사용자의 입력을 별도 스레드에서 처리해 실시간을 동기화하는 게 예가 될 수 있을 듯.

(물론 엄밀하게는 멀티스레드는 논리적으로는 병렬 실행되지만, 실제 동시성은 CPU 코어 수와 스케줄링에 따라 상이하다. 단일 코어 환경에서는 time-slicing으로 번갈아 실행된다)

내가 생각하는 비동기 방식과 멀티스레드의 차이점은 멀티 스레드는 문자 그대로 하나의 프로세스에서 여러 개의 스레드를 이용해 '동시에' 여러 실행 흐름이 있는 반면, 비동기 방식은 단일 스레드일 수도 있고 멀티 스레드 환경일 수도 있다. 즉, 스레드는 어차피 CPU 자원이 필요한 일이기에 멀티 스레드 환경에서 각 스레드는 CPU의 자원을 각각 점유하고 사용하는 반면, 비동기 방식의 대표적인 예로 거론되는 IO 작업은 CPU 자원이 상대적으로 덜 필요한(?) 일이기에 멀티 스레드와는 하등 관련이 없다. 아니 어쩌면 CPU 자원과 상관 없는 작업을 하기에 그 시간만큼 CPU 자원이 그냥 하릴없이 기다리기에 비동기 방식이 출현한 걸지도 모르겠다..